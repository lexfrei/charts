{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Cloudflare Tunnel Values",
  "type": "object",
  "properties": {
    "cloudflare": {
      "type": "object",
      "properties": {
        "mode": {
          "type": "string",
          "description": "Tunnel management mode: local or remote.",
          "enum": ["local", "remote"],
          "default": "local"
        },
        "tunnelToken": {
          "type": "string",
          "description": "Tunnel token for remote mode."
        },
        "tunnelTokenSecretName": {
          "type": "string",
          "description": "Secret name containing tunnel token (key: token)."
        },
        "account": {
          "type": "string",
          "description": "Your Cloudflare account number (local mode only)."
        },
        "tunnelName": {
          "type": "string",
          "description": "The name of the tunnel (local mode only)."
        },
        "tunnelId": {
          "type": "string",
          "description": "The ID of the tunnel (local mode only)."
        },
        "secret": {
          "type": "string",
          "description": "The secret for the tunnel (local mode only)."
        },
        "secretName": {
          "type": [
            "string",
            "null"
          ],
          "description": "Reference to a secret (local mode only)."
        },
        "enableWarp": {
          "type": "boolean",
          "description": "If true, turn on WARP routing for TCP.",
          "default": false
        },
        "ingress": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "hostname": {
                "type": "string"
              },
              "service": {
                "type": "string"
              }
            }
          },
          "description": "Define ingress rules for the tunnel."
        },
        "enableDefault404": {
          "type": "boolean",
          "description": "Enable the default 404 page.",
          "default": true
        },
        "originRequest": {
          "type": "object",
          "description": "Global originRequest configuration for all ingress rules.",
          "properties": {
            "connectTimeout": {
              "type": "string",
              "description": "Timeout for establishing a new TCP connection."
            },
            "tlsTimeout": {
              "type": "string",
              "description": "Timeout for completing a TLS handshake."
            },
            "keepAliveTimeout": {
              "type": "string",
              "description": "Timeout after which an idle keepalive connection is closed."
            },
            "noHappyEyeballs": {
              "type": "boolean",
              "description": "Disable the Happy Eyeballs algorithm."
            },
            "keepAliveConnections": {
              "type": "integer",
              "description": "Maximum number of idle keepalive connections."
            },
            "httpHostHeader": {
              "type": "string",
              "description": "Sets the HTTP Host header for the local service."
            },
            "originServerName": {
              "type": "string",
              "description": "Hostname to use for TLS verification."
            },
            "caPool": {
              "type": "string",
              "description": "Path to the CA certificate."
            },
            "noTLSVerify": {
              "type": "boolean",
              "description": "Disables TLS verification of the origin."
            },
            "disableChunkedEncoding": {
              "type": "boolean",
              "description": "Disables chunked transfer encoding."
            },
            "bastionMode": {
              "type": "boolean",
              "description": "Runs the tunnel as a bastion."
            },
            "proxyAddress": {
              "type": "string",
              "description": "Address of the proxy."
            },
            "proxyPort": {
              "type": "integer",
              "description": "Port of the proxy."
            },
            "proxyType": {
              "type": "string",
              "description": "Type of proxy."
            },
            "http2Origin": {
              "type": "boolean",
              "description": "Use HTTP/2 for connections to the origin."
            }
          }
        }
      },
      "allOf": [
        {
          "if": {
            "properties": { "mode": { "const": "local" } }
          },
          "then": {
            "required": ["account", "tunnelName", "tunnelId"]
          }
        },
        {
          "if": {
            "properties": { "mode": { "const": "remote" } }
          },
          "then": {
            "anyOf": [
              { "required": ["tunnelToken"] },
              { "required": ["tunnelTokenSecretName"] }
            ]
          }
        }
      ]
    },
    "image": {
      "type": "object",
      "properties": {
        "repository": {
          "type": "string",
          "description": "Docker repository for the image.",
          "default": "cloudflare/cloudflared"
        },
        "pullPolicy": {
          "type": "string",
          "description": "Pull policy for the image.",
          "default": "IfNotPresent"
        },
        "tag": {
          "type": [
            "string",
            "null"
          ],
          "description": "Override the appVersion tag."
        }
      }
    },
    "replicaCount": {
      "type": "integer",
      "description": "Number of replicas to deploy.",
      "default": 2
    },
    "imagePullSecrets": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Secrets for pulling images."
    },
    "serviceAccount": {
      "type": "object",
      "properties": {
        "annotations": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Annotations to add to the service account (must be string key-value pairs)"
        },
        "name": {
          "type": [
            "string",
            "null"
          ],
          "description": "Name of the service account."
        }
      }
    },
    "podAnnotations": {
      "type": "object",
      "additionalProperties": {
        "type": "string"
      },
      "description": "Pod annotations (must be string key-value pairs)"
    },
    "podSecurityContext": {
      "type": "object",
      "properties": {
        "runAsNonRoot": {
          "type": "boolean",
          "default": true
        },
        "runAsUser": {
          "type": "integer",
          "default": 65532
        }
      }
    },
    "securityContext": {
      "type": "object",
      "properties": {
        "allowPrivilegeEscalation": {
          "type": "boolean",
          "default": false
        },
        "capabilities": {
          "type": "object",
          "properties": {
            "drop": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": ["ALL"]
            }
          }
        },
        "readOnlyRootFilesystem": {
          "type": "boolean",
          "default": true
        }
      }
    },
    "resources": {
      "type": "object",
      "description": "Resource limits and requests for the containers."
    },
    "nodeSelector": {
      "type": "object"
    },
    "tolerations": {
      "type": "array",
      "items": {
        "type": "object"
      }
    },
    "affinity": {
      "type": "object"
    },
    "serviceMonitor": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable prometheus Service Monitor.",
          "default": false
        },
        "jobLabel": {
          "type": "string",
          "description": "Job label for the ServiceMonitor."
        },
        "interval": {
          "type": "string",
          "description": "Scrape interval for Prometheus."
        },
        "metricRelabelings": {
          "type": "array",
          "description": "Metric relabelings for the ServiceMonitor."
        },
        "relabelings": {
          "type": "array",
          "description": "Relabelings for the ServiceMonitor."
        }
      }
    },
    "podDisruptionBudget": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable Pod Disruption Budget.",
          "default": false
        },
        "minAvailable": {
          "type": ["integer", "string"],
          "description": "Minimum number of available pods.",
          "default": 1
        },
        "maxUnavailable": {
          "type": ["integer", "string"],
          "description": "Maximum number of unavailable pods."
        }
      }
    },
    "topologySpreadConstraints": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "maxSkew": {
            "type": "integer"
          },
          "topologyKey": {
            "type": "string"
          },
          "whenUnsatisfiable": {
            "type": "string",
            "enum": ["DoNotSchedule", "ScheduleAnyway"]
          },
          "labelSelector": {
            "type": "object"
          }
        },
        "required": ["maxSkew", "topologyKey", "whenUnsatisfiable"]
      },
      "description": "Topology spread constraints for pod distribution."
    },
    "priorityClassName": {
      "type": "string",
      "description": "Priority class name for pod scheduling priority."
    },
    "metricsPort": {
      "type": "integer",
      "description": "Metrics port for Prometheus metrics and readiness probe.",
      "default": 2000
    },
    "livenessProbe": {
      "type": "object",
      "description": "Liveness probe configuration.",
      "properties": {
        "failureThreshold": {
          "type": "integer",
          "description": "Failure threshold for liveness probe.",
          "default": 1
        },
        "initialDelaySeconds": {
          "type": "integer",
          "description": "Initial delay before liveness probe starts.",
          "default": 30
        },
        "periodSeconds": {
          "type": "integer",
          "description": "Period between liveness probe checks.",
          "default": 10
        },
        "timeoutSeconds": {
          "type": "integer",
          "description": "Timeout for liveness probe."
        }
      }
    },
    "logLevel": {
      "type": "string",
      "description": "Log level for cloudflared (debug, info, warn, error, fatal).",
      "enum": ["debug", "info", "warn", "error", "fatal", ""]
    },
    "podLabels": {
      "type": "object",
      "description": "Additional labels to add to pods."
    },
    "deploymentMode": {
      "type": "string",
      "description": "Deployment mode: deployment or daemonset.",
      "enum": ["deployment", "daemonset"],
      "default": "deployment"
    },
    "protocol": {
      "type": "string",
      "description": "Transport protocol for cloudflared",
      "enum": ["auto", "quic", "http2", ""],
      "default": ""
    },
    "postQuantum": {
      "type": "boolean",
      "description": "Enable post-quantum cryptography for QUIC connections (only works with quic/auto protocol)",
      "default": false
    },
    "region": {
      "type": "string",
      "description": "Cloudflare region (us for US-only, empty for global)",
      "enum": ["us", ""],
      "default": ""
    },
    "retries": {
      "type": "string",
      "description": "Maximum retries for connection/protocol errors",
      "pattern": "^([1-9][0-9]*|)$",
      "default": ""
    },
    "edgeIpVersion": {
      "type": "string",
      "description": "IP version for edge connections",
      "enum": ["auto", "4", "6", ""],
      "default": ""
    },
    "gracePeriod": {
      "type": "string",
      "description": "Graceful shutdown timeout (e.g., 30s, 1m)",
      "pattern": "^([0-9]+[smh]([0-9]+[smh])*|[0-9]+[smh]?|)$",
      "default": ""
    },
    "edgeBindAddress": {
      "type": "string",
      "description": "Edge bind address for outgoing connections",
      "pattern": "^(((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|([0-9a-fA-F]{0,4}:){2,7}[0-9a-fA-F]{0,4}|)$",
      "default": ""
    },
    "tags": {
      "type": "object",
      "description": "Tags for tunnel identification and monitoring",
      "additionalProperties": {
        "type": "string"
      },
      "default": {}
    },
    "sidecar": {
      "type": "object",
      "description": "Sidecar configuration for additional containers",
      "properties": {
        "initContainers": {
          "type": "array",
          "description": "Init containers to run before main containers",
          "items": {
            "type": "object"
          },
          "default": []
        },
        "containers": {
          "type": "array",
          "description": "Additional sidecar containers",
          "items": {
            "type": "object"
          },
          "default": []
        },
        "extraVolumes": {
          "type": "array",
          "description": "Extra volumes for sidecar containers",
          "items": {
            "type": "object"
          },
          "default": []
        },
        "extraVolumeMounts": {
          "type": "array",
          "description": "Extra volume mounts for the cloudflared container",
          "items": {
            "type": "object"
          },
          "default": []
        }
      }
    }
  },
  "required": [
    "cloudflare",
    "image",
    "replicaCount"
  ]
}