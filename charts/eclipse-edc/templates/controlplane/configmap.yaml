{{- if .Values.controlPlane.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "eclipse-edc.controlplane.fullname" . }}
  labels:
    {{- include "eclipse-edc.controlplane.labels" . | nindent 4 }}
data:
  edc.properties: |
    # EDC Control Plane Configuration
    # Generated by Helm chart

    # Web server ports
    web.http.default.port={{ .Values.controlPlane.ports.default }}
    web.http.default.path=/api
    web.http.management.port={{ .Values.controlPlane.ports.management }}
    web.http.management.path=/management
    web.http.protocol.port={{ .Values.controlPlane.ports.protocol }}
    web.http.protocol.path=/protocol

    {{- if .Values.controlPlane.config.participantId }}
    # Participant configuration
    edc.participant.id={{ .Values.controlPlane.config.participantId }}
    {{- end }}

    # Data source configuration
    edc.datasource.default.url={{ include "eclipse-edc.postgresql.jdbcUrl" . }}
    {{- if .Values.postgresql.enabled }}
    edc.datasource.default.user={{ .Values.postgresql.auth.username | default "edc" }}
    {{- else if .Values.postgresql.external.host }}
    # External PostgreSQL - credentials should be provided via secrets
    {{- end }}
{{- end }}
