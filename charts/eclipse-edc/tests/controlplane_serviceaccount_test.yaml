suite: test control plane service account
templates:
  - controlplane/serviceaccount.yaml
tests:
  - it: should create service account when enabled
    set:
      controlPlane:
        enabled: true
        serviceAccount:
          create: true
    asserts:
      - isKind:
          of: ServiceAccount
      - equal:
          path: metadata.name
          value: RELEASE-NAME-eclipse-edc-controlplane

  - it: should NOT create service account when controlPlane is disabled
    set:
      controlPlane:
        enabled: false
        serviceAccount:
          create: true
    asserts:
      - hasDocuments:
          count: 0

  - it: should NOT create service account when create is false
    set:
      controlPlane:
        enabled: true
        serviceAccount:
          create: false
    asserts:
      - hasDocuments:
          count: 0

  - it: should add annotations when specified
    set:
      controlPlane:
        enabled: true
        serviceAccount:
          create: true
          annotations:
            custom-annotation: "value"
    asserts:
      - equal:
          path: metadata.annotations["custom-annotation"]
          value: "value"

  - it: should use custom name when specified
    set:
      controlPlane:
        enabled: true
        serviceAccount:
          create: true
          name: "custom-sa"
    asserts:
      - equal:
          path: metadata.name
          value: custom-sa

  - it: should have correct labels
    set:
      controlPlane:
        enabled: true
        serviceAccount:
          create: true
    asserts:
      - equal:
          path: metadata.labels["app.kubernetes.io/component"]
          value: controlplane
