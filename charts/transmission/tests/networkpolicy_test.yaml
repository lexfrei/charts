suite: test networkpolicy
templates:
  - networkpolicy.yaml
tests:
  - it: should not create NetworkPolicy by default
    asserts:
      - hasDocuments:
          count: 0

  - it: should create NetworkPolicy when enabled
    set:
      networkPolicy.enabled: true
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: NetworkPolicy
      - equal:
          path: metadata.name
          value: RELEASE-NAME-transmission

  - it: should have 3 default ingress rules
    set:
      networkPolicy.enabled: true
    asserts:
      - lengthEqual:
          path: spec.ingress
          count: 3

  - it: should allow Web UI access
    set:
      networkPolicy.enabled: true
    asserts:
      - contains:
          path: spec.ingress[0].ports
          content:
            protocol: TCP
            port: 9091

  - it: should have 3 default egress rules
    set:
      networkPolicy.enabled: true
    asserts:
      - lengthEqual:
          path: spec.egress
          count: 3

  - it: should allow DNS egress
    set:
      networkPolicy.enabled: true
    asserts:
      - contains:
          path: spec.egress[0].ports
          content:
            protocol: UDP
            port: 53
