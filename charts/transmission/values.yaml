# Default values for transmission

# -- Image configuration
image:
  repository: linuxserver/transmission
  pullPolicy: IfNotPresent
  # -- Overrides the image tag whose default is the chart appVersion
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# -- Environment variables for Transmission container
env:
  # -- User ID to run as
  PUID: "1000"
  # -- Group ID to run as
  PGID: "1000"
  # -- Timezone
  TZ: "Europe/Moscow"

# -- Security context for the pod
podSecurityContext:
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

# -- Security context for the container
securityContext:
  allowPrivilegeEscalation: false  # Prevent privilege escalation
  capabilities:
    add:
      - SETUID   # Required for UID changes
      - SETGID   # Required for GID changes
      - CHOWN    # Required for file ownership changes
    drop:
      - ALL      # Drop all other capabilities
  readOnlyRootFilesystem: false  # linuxserver image needs to write to /config

# -- Service configuration
service:
  # -- Main service for Web UI (ClusterIP for HTTPRoute/Ingress)
  web:
    # -- Service type for Web UI
    type: ClusterIP
    # -- HTTP port
    port: 9091
    # -- Annotations for Web UI service
    annotations: {}

  # -- Separate LoadBalancer service for torrent ports
  torrent:
    # -- Enable separate torrent service
    enabled: true
    # -- Service type for torrent traffic
    type: LoadBalancer
    # -- Annotations for torrent service (e.g., Cilium LB-IPAM, MetalLB)
    annotations: {}
    # -- Torrent TCP port
    tcpPort: 51413
    # -- Torrent UDP port
    udpPort: 51413

# -- Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: transmission.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: transmission-tls
      hosts:
        - transmission.example.com

# -- HTTPRoute configuration (Gateway API)
httpRoute:
  enabled: false
  annotations: {}
  # -- Parent Gateway references
  parentRefs:
    - name: gateway
      namespace: gateway-system
      # sectionName: https-listener  # Optional: specific listener on the Gateway
  # -- Hostnames for the route
  hostnames:
    - transmission.example.com
  # -- Routing rules
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /

# -- Resource limits and requests
resources:
  requests:
    memory: "256Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "400m"

# -- Liveness probe configuration
livenessProbe:
  # -- Path to check for write access (detects NFS mount failures)
  fsCheckPath: /downloads
  # -- Initial delay before liveness probe starts
  initialDelaySeconds: 30
  # -- Period between liveness probe checks
  periodSeconds: 10
  # -- Timeout for liveness probe
  timeoutSeconds: 5
  # -- Failure threshold for liveness probe
  failureThreshold: 6

# -- Readiness probe configuration
readinessProbe:
  # -- Initial delay before readiness probe starts
  initialDelaySeconds: 10
  # -- Period between readiness probe checks
  periodSeconds: 5
  # -- Timeout for readiness probe
  timeoutSeconds: 3
  # -- Failure threshold for readiness probe
  failureThreshold: 3

# -- Persistence configuration
persistence:
  # -- Config volume configuration
  config:
    enabled: true
    # -- Storage class name
    storageClassName: ""
    # -- Access mode
    accessMode: ReadWriteOnce
    # -- Size of the volume
    size: 1Gi
    # -- If you want to use an existing PVC
    existingClaim: ""

  # -- Downloads volume configuration
  downloads:
    enabled: true
    # -- Type of storage (pvc or nfs)
    # When using existingClaim, type MUST be set to "pvc"
    type: nfs
    # -- NFS server (when type is nfs)
    nfsServer: nfs-server.example.com
    # -- NFS path (when type is nfs)
    nfsPath: /mnt/downloads
    # -- Storage class (when type is pvc)
    storageClassName: ""
    # -- Access mode (when type is pvc)
    accessMode: ReadWriteMany
    # -- Size (when type is pvc)
    size: 100Gi
    # -- Existing PVC claim name. When specified, type MUST be "pvc".
    # Useful for sharing storage between multiple apps (e.g., with Jellyfin).
    # Example: set type to "pvc" and existingClaim to "shared-media-storage"
    existingClaim: ""

nodeSelector: {}

tolerations: []

affinity: {}

# -- Pod annotations
podAnnotations: {}

# -- Pod labels
podLabels: {}

# -- Service account configuration
serviceAccount:
  # -- Specifies whether a service account should be created
  create: true
  # -- Annotations to add to the service account
  annotations: {}
  # -- The name of the service account to use
  name: ""

# -- Update strategy
updateStrategy:
  type: RollingUpdate

# -- Init containers to run before the main container
# @default -- []
initContainers: []
# Example:
# - name: init-permissions
#   image: busybox:latest
#   command: ['sh', '-c', 'chown -R 1000:1000 /downloads']
#   volumeMounts:
#     - name: downloads
#       mountPath: /downloads
#   securityContext:
#     runAsUser: 0

# -- Network Policy configuration
networkPolicy:
  # -- Enable NetworkPolicy
  enabled: false
  # -- Additional ingress rules
  ingress: []
  # -- Additional egress rules
  egress: []

# -- Extra volumes to add to the pod (raw Kubernetes volume specs)
# @default -- []
extraVolumes: []
# - name: extra-data
#   persistentVolumeClaim:
#     claimName: my-existing-pvc
# - name: temp-storage
#   emptyDir: {}

# -- Extra volume mounts for the container
# @default -- []
extraVolumeMounts: []
# - name: extra-data
#   mountPath: /extra-data
# - name: temp-storage
#   mountPath: /tmp

# -- Extra PersistentVolumes for static provisioning (created by this chart)
# @default -- []
extraPersistentVolumes: []
# - name: extra-nfs-pv
#   capacity: 100Gi
#   accessModes:
#     - ReadWriteMany
#   storageClassName: ""
#   nfs:
#     server: 192.168.1.100
#     path: /exports/data
# - name: extra-hostpath-pv
#   capacity: 50Gi
#   accessModes:
#     - ReadWriteOnce
#   storageClassName: manual
#   hostPath:
#     path: /mnt/data
#     type: DirectoryOrCreate

# -- Extra PersistentVolumeClaims (created by this chart)
# @default -- []
extraPersistentVolumeClaims: []
# - name: extra-pvc
#   storageClassName: ""
#   accessModes:
#     - ReadWriteOnce
#   size: 10Gi
#   volumeName: extra-nfs-pv  # Optional: bind to specific PV
