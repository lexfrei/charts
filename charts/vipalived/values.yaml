# Default values for vipalived.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- Override the name of the chart
nameOverride: ""

# -- Override the full name of the chart
fullnameOverride: ""

# -- Namespace to deploy vipalived into
namespace: kube-system

# -- Enable static pod mode for Day 1 cluster bootstrap.
# When true, renders a Pod manifest instead of DaemonSet with embedded configuration.
# Use this for pre-CNI VIP availability during initial cluster setup.
# For Day 2 operations (existing cluster), keep this false (default).
static: false

image:
  # -- Container image repository
  repository: alpine
  # -- Image pull policy
  pullPolicy: IfNotPresent
  # -- Container image tag (defaults to chart appVersion if not set)
  tag: ""

# -- Image pull secrets for private registries
imagePullSecrets: []

keepalived:
  # -- Router identifier for keepalived
  routerId: vipalived
  # -- VRRP protocol version (2 or 3)
  vrrpVersion: 3

  garp:
    # -- Delay for gratuitous ARP after master transition
    masterDelay: 5
    # -- Interval for gratuitous ARP refresh on master
    masterRefresh: 10
    # -- Number of gratuitous ARP packets to send at master transition
    masterRepeat: 5
    # -- Number of gratuitous ARP packets to send at refresh
    masterRefreshRepeat: 1

  vrrpInstance:
    # -- VRRP instance name
    name: VI_CONTROL_PLANE
    # -- Initial VRRP state (MASTER or BACKUP)
    state: BACKUP
    # -- Network interface to use for VRRP
    interface: eth0
    # -- VRRP priority (higher values are preferred)
    priority: 100
    # -- Virtual router ID (must be unique in the network)
    virtualRouterId: 51
    # -- Advertisement interval in seconds
    advertInt: 1
    # -- Enable non-preemptive mode
    nopreempt: true

    authentication:
      # -- Authentication type (PASS or AH)
      authType: PASS
      # -- Authentication password (max 8 characters for PASS)
      authPass: k8s_vip

    # -- Virtual IP address with CIDR notation
    virtualIpAddress: 172.16.101.101/32

    # -- Interfaces to track for VRRP state transitions.
    # When a tracked interface goes down, keepalived transitions to FAULT state.
    # This is a workaround for keepalived issue 1847.
    # @default -- [] (no tracking)
    trackInterface: []

updateStrategy:
  # -- Update strategy type
  type: RollingUpdate
  # -- Maximum number of unavailable pods during update
  maxUnavailable: 1

# -- Enable host network mode (required for VIP functionality)
hostNetwork: true

# -- Priority class name for pod scheduling
priorityClassName: system-node-critical

# -- Node selector for pod assignment
nodeSelector:
  node-role.kubernetes.io/control-plane: "true"

# -- Tolerations for pod assignment.
# Uses catch-all toleration by default because vipalived is critical infrastructure
# that MUST run on every control-plane node regardless of any taints applied
# (e.g., workload-specific taints like minecraft=true:NoExecute).
tolerations:
  - operator: Exists

# -- Affinity rules for pod assignment
affinity: {}

# -- Security context for the pod
podSecurityContext:
  seccompProfile:
    type: RuntimeDefault

# -- Security context for the container
securityContext:
  capabilities:
    add:
      - NET_ADMIN
      - NET_RAW
      - NET_BROADCAST

# -- Startup probe configuration for initial VIP acquisition
startupProbe:
  # -- Enable startup probe
  enabled: false
  # -- Exec probe configuration
  exec:
    # -- Command to execute for the probe
    # @default -- [] (no command, must be set when enabled)
    command: []
  # -- Period between startup probe checks
  periodSeconds: 5
  # -- Timeout for startup probe
  timeoutSeconds: 5
  # -- Failure threshold for startup probe
  failureThreshold: 12

# -- Liveness probe configuration
livenessProbe:
  # -- Enable liveness probe
  enabled: true
  # -- Exec probe configuration
  exec:
    # -- Command to execute for the probe
    command:
      - pgrep
      - keepalived
  # -- Initial delay before liveness probe starts
  initialDelaySeconds: 15
  # -- Period between liveness probe checks
  periodSeconds: 10
  # -- Timeout for liveness probe
  timeoutSeconds: 5
  # -- Failure threshold for liveness probe
  failureThreshold: 3

# -- Readiness probe configuration
readinessProbe:
  # -- Enable readiness probe
  enabled: false
  # -- Exec probe configuration
  exec:
    # -- Command to execute for the probe
    # @default -- [] (no command, must be set when enabled)
    command: []
  # -- Period between readiness probe checks
  periodSeconds: 10
  # -- Timeout for readiness probe
  timeoutSeconds: 5
  # -- Failure threshold for readiness probe
  failureThreshold: 3
  # -- Success threshold for readiness probe
  successThreshold: 1

# -- Resource requests and limits
resources:
  limits:
    cpu: 100m
    memory: 64Mi
  requests:
    cpu: 50m
    memory: 32Mi

# -- Additional labels for pods
podLabels: {}

# -- Annotations for pods
podAnnotations: {}
